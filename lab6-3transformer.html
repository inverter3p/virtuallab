<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>EX06: Three-Phase Transformer - Virtual Lab</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <link
      href="https://fonts.googleapis.com/icon?family=Material+Icons+Outlined"
      rel="stylesheet"
    />
    <style>
      @import url("https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap");
      body {
        font-family: "Inter", sans-serif;
      }
      .section-card {
        background-color: white;
        border-radius: 0.75rem;
        box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1),
          0 2px 4px -2px rgb(0 0 0 / 0.1);
        padding: 1.5rem;
        margin-bottom: 1.5rem;
      }
      .section-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 0.75rem;
      }
      .data-table input {
        width: 100%;
        min-width: 80px;
        padding: 0.5rem;
        border: 1px solid #d1d5db;
        border-radius: 0.375rem;
        text-align: center;
      }
      .data-table th,
      .data-table td {
        padding: 0.75rem;
        text-align: center;
        vertical-align: middle;
      }
      .data-table .label-col {
        text-align: left;
        font-weight: 500;
        color: #374151;
      }
      .modal-trigger-btn {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        padding: 0.5rem 1rem;
        border-radius: 0.5rem;
        background-color: #eef2ff;
        color: #4338ca;
        font-weight: 500;
        transition: background-color 0.2s;
        border: 1px solid #c7d2fe;
        cursor: pointer;
      }
      .modal-trigger-btn:hover {
        background-color: #e0e7ff;
      }
      #instruction-modal.hidden {
        display: none;
      }
      textarea {
        width: 100%;
        min-height: 120px;
        padding: 0.75rem;
        border: 1px solid #d1d5db;
        border-radius: 0.5rem;
        margin-top: 0.5rem;
      }
      .waveform-uploader {
        border: 2px dashed #d1d5db;
        border-radius: 0.5rem;
        padding: 1.5rem;
        text-align: center;
        cursor: pointer;
        background-color: #f9fafb;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
      }
      .waveform-uploader img {
        max-height: 200px;
        margin: 1rem auto 0;
        border-radius: 0.375rem;
        box-shadow: 0 1px 3px 0 rgb(0 0 0 / 0.1);
      }
      .wiring-btn {
        padding: 0.4rem 0.8rem;
        background-color: #f3f4f6;
        color: #4b5563;
        border: 1px solid #e5e7eb;
      }
      .wiring-btn:hover {
        background-color: #e5e7eb;
      }
    </style>
  </head>
  <body class="bg-gray-100 text-gray-800">
    <div id="app-container" class="max-w-7xl mx-auto p-4 sm:p-6 lg:p-8">
      <header
        class="section-card pdf-section flex flex-col sm:flex-row justify-between items-center"
      >
        <div>
          <h1 class="text-3xl font-bold text-blue-700">
            EX06: Three-Phase Transformer
          </h1>
          <p class="text-gray-600 mt-1">
            Department of Electrical Engineering, Kasetsart University
          </p>
        </div>
        <button
          id="export-pdf"
          class="mt-4 sm:mt-0 bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg shadow-md transition-transform transform hover:scale-105"
        >
          Export as PDF
        </button>
      </header>

      <div class="section-card pdf-section">
        <h2
          class="text-2xl font-semibold border-b pb-2 mb-4 text-blue-800 flex items-center gap-3"
        >
          <span class="material-icons-outlined">list_alt</span>Procedure Steps
        </h2>
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
          <button
            class="modal-trigger-btn justify-center"
            data-modal-target="section1"
          >
            <svg
              version="1.1"
              xmlns="http://www.w3.org/2000/svg"
              x="0px"
              y="0px"
              viewBox="0 0 256 256"
              width="24"
              height="24"
            >
              <g>
                <g>
                  <g>
                    <path
                      fill="currentColor"
                      d="M98,128v100.5h9.9h9.9V128V27.5h-9.9H98V128z"
                    />
                    <path
                      fill="currentColor"
                      d="M138.1,128v100.5h9.9h9.9V128V27.5h-9.9h-9.9V128z"
                    />
                    <path
                      fill="currentColor"
                      d="M16.3,33L10,33.1v9.6v9.6l22,0.1c21.5,0.1,22,0.1,23.8,1.2c8.3,4.4,8.3,16.1,0.1,20.2c-1.3,0.6-3,1.2-3.6,1.2H51v10.3v10.3l1.7,0.3c4,0.7,7.7,4,8.8,7.6c1.3,4.4,0.3,8.6-3,11.7c-3.3,3.1-3.3,3.1-27.2,3.1H10v10.1v10.1h21.4c23.9,0,23.9,0,27.2,3.1c3.2,3.1,4.3,7.3,3,11.7c-1.1,3.6-4.8,6.8-8.8,7.6l-1.7,0.3v9.8v9.8l1.9,0.3c2.8,0.4,5.9,2.5,7.5,5.1c3.4,5.5,1.3,13-4.5,16.1c-1.8,1-2.3,1-23.9,1.2l-22,0.1v9.6v9.7h22.7c25.5,0,25.3,0,32.1-3.3c4.8-2.4,10.5-7.7,13-12.4c6-10.9,5-24.2-2.5-34l-1.9-2.4l1.2-1.2c2-2.1,4.5-6.6,5.7-10.5c3-9.5,1.4-19.2-4.7-27.7l-2.1-3l2.1-2.9c8.4-11.7,8.2-26.8-0.4-37.4l-2.1-2.5l2.2-2.9c7.8-10.1,8.6-23.8,2.1-34.8c-2.7-4.5-7.8-9.2-12.6-11.6c-6.5-3.1-7.5-3.3-25.8-3.4C30,32.9,19.8,32.9,16.3,33z"
                    />
                    <path
                      fill="currentColor"
                      d="M202.9,33.1c-4.5,0.3-5.1,0.4-9,1.9c-5.8,2.3-12.2,7.6-15.4,13c-0.9,1.5-2.2,4.4-2.9,6.5c-1.1,3.1-1.2,4.5-1.2,9.2c0,7.7,1.8,13.1,6.3,19l1.8,2.4l-1.7,2c-0.9,1.1-2.5,3.6-3.5,5.7c-5.1,10.6-4,22,3,31.9l2.1,2.9l-1.8,2.4c-4.4,5.7-6.9,13.8-6.4,20.8c0.5,6.5,3.5,14.2,7.3,18.1l1.4,1.4l-1.9,2.4c-4.6,5.8-6.6,11.8-6.7,19.3c0,9.1,2.5,15.2,9,21.7c3.2,3.2,4.7,4.3,7.8,5.9c6.8,3.3,6.7,3.3,32.1,3.3H246v-9.7v-9.6l-22-0.1c-21.8-0.1-22.1-0.1-23.9-1.2c-5.9-3.1-7.9-10.6-4.5-16.1c1.6-2.5,4.7-4.7,7.5-5.1l1.9-0.3v-10.2v-10.3l-1.7-0.3c-7.8-1.5-11.8-10.4-7.7-17.1c1.6-2.5,4.7-4.7,7.5-5.1l1.9-0.3v-10c0-9.3,0-10.1-0.8-10.1c-3.3,0-7.8-3.2-9.4-6.7c-1-2.2-1.2-6.5-0.2-8.7c1.4-3.4,6.3-7.2,9.4-7.2h1V85v-9.8l-1.9-0.3c-2.8-0.4-5.9-2.5-7.5-5.1c-3.4-5.5-1.3-13,4.5-16.1c1.8-1,2.2-1,23.9-1.2l22-0.1v-9.6v-9.7l-4.9,0c-2.8,0-11.5,0-19.5-0.1C213.6,32.9,205.2,33,202.9,33.1z"
                    />
                  </g>
                </g>
              </g>
            </svg>
            <span>1. Δ-Δ Connection</span>
          </button>
          <button
            class="modal-trigger-btn justify-center"
            data-modal-target="section2"
          >
            <svg
              version="1.1"
              xmlns="http://www.w3.org/2000/svg"
              x="0px"
              y="0px"
              viewBox="0 0 256 256"
              width="24"
              height="24"
            >
              <g>
                <g>
                  <g>
                    <path
                      fill="currentColor"
                      d="M98,128v100.5h9.9h9.9V128V27.5h-9.9H98V128z"
                    />
                    <path
                      fill="currentColor"
                      d="M138.1,128v100.5h9.9h9.9V128V27.5h-9.9h-9.9V128z"
                    />
                    <path
                      fill="currentColor"
                      d="M16.3,33L10,33.1v9.6v9.6l22,0.1c21.5,0.1,22,0.1,23.8,1.2c8.3,4.4,8.3,16.1,0.1,20.2c-1.3,0.6-3,1.2-3.6,1.2H51v10.3v10.3l1.7,0.3c4,0.7,7.7,4,8.8,7.6c1.3,4.4,0.3,8.6-3,11.7c-3.3,3.1-3.3,3.1-27.2,3.1H10v10.1v10.1h21.4c23.9,0,23.9,0,27.2,3.1c3.2,3.1,4.3,7.3,3,11.7c-1.1,3.6-4.8,6.8-8.8,7.6l-1.7,0.3v9.8v9.8l1.9,0.3c2.8,0.4,5.9,2.5,7.5,5.1c3.4,5.5,1.3,13-4.5,16.1c-1.8,1-2.3,1-23.9,1.2l-22,0.1v9.6v9.7h22.7c25.5,0,25.3,0,32.1-3.3c4.8-2.4,10.5-7.7,13-12.4c6-10.9,5-24.2-2.5-34l-1.9-2.4l1.2-1.2c2-2.1,4.5-6.6,5.7-10.5c3-9.5,1.4-19.2-4.7-27.7l-2.1-3l2.1-2.9c8.4-11.7,8.2-26.8-0.4-37.4l-2.1-2.5l2.2-2.9c7.8-10.1,8.6-23.8,2.1-34.8c-2.7-4.5-7.8-9.2-12.6-11.6c-6.5-3.1-7.5-3.3-25.8-3.4C30,32.9,19.8,32.9,16.3,33z"
                    />
                    <path
                      fill="currentColor"
                      d="M202.9,33.1c-4.5,0.3-5.1,0.4-9,1.9c-5.8,2.3-12.2,7.6-15.4,13c-0.9,1.5-2.2,4.4-2.9,6.5c-1.1,3.1-1.2,4.5-1.2,9.2c0,7.7,1.8,13.1,6.3,19l1.8,2.4l-1.7,2c-0.9,1.1-2.5,3.6-3.5,5.7c-5.1,10.6-4,22,3,31.9l2.1,2.9l-1.8,2.4c-4.4,5.7-6.9,13.8-6.4,20.8c0.5,6.5,3.5,14.2,7.3,18.1l1.4,1.4l-1.9,2.4c-4.6,5.8-6.6,11.8-6.7,19.3c0,9.1,2.5,15.2,9,21.7c3.2,3.2,4.7,4.3,7.8,5.9c6.8,3.3,6.7,3.3,32.1,3.3H246v-9.7v-9.6l-22-0.1c-21.8-0.1-22.1-0.1-23.9-1.2c-5.9-3.1-7.9-10.6-4.5-16.1c1.6-2.5,4.7-4.7,7.5-5.1l1.9-0.3v-10.2v-10.3l-1.7-0.3c-7.8-1.5-11.8-10.4-7.7-17.1c1.6-2.5,4.7-4.7,7.5-5.1l1.9-0.3v-10c0-9.3,0-10.1-0.8-10.1c-3.3,0-7.8-3.2-9.4-6.7c-1-2.2-1.2-6.5-0.2-8.7c1.4-3.4,6.3-7.2,9.4-7.2h1V85v-9.8l-1.9-0.3c-2.8-0.4-5.9-2.5-7.5-5.1c-3.4-5.5-1.3-13,4.5-16.1c1.8-1,2.2-1,23.9-1.2l22-0.1v-9.6v-9.7l-4.9,0c-2.8,0-11.5,0-19.5-0.1C213.6,32.9,205.2,33,202.9,33.1z"
                    />
                  </g>
                </g>
              </g>
            </svg>
            <span>2. Δ-Y Connection</span>
          </button>
          <button
            class="modal-trigger-btn justify-center"
            data-modal-target="section3"
          >
            <svg
              version="1.1"
              xmlns="http://www.w3.org/2000/svg"
              x="0px"
              y="0px"
              viewBox="0 0 256 256"
              width="24"
              height="24"
            >
              <g>
                <g>
                  <g>
                    <path
                      fill="currentColor"
                      d="M98,128v100.5h9.9h9.9V128V27.5h-9.9H98V128z"
                    />
                    <path
                      fill="currentColor"
                      d="M138.1,128v100.5h9.9h9.9V128V27.5h-9.9h-9.9V128z"
                    />
                    <path
                      fill="currentColor"
                      d="M16.3,33L10,33.1v9.6v9.6l22,0.1c21.5,0.1,22,0.1,23.8,1.2c8.3,4.4,8.3,16.1,0.1,20.2c-1.3,0.6-3,1.2-3.6,1.2H51v10.3v10.3l1.7,0.3c4,0.7,7.7,4,8.8,7.6c1.3,4.4,0.3,8.6-3,11.7c-3.3,3.1-3.3,3.1-27.2,3.1H10v10.1v10.1h21.4c23.9,0,23.9,0,27.2,3.1c3.2,3.1,4.3,7.3,3,11.7c-1.1,3.6-4.8,6.8-8.8,7.6l-1.7,0.3v9.8v9.8l1.9,0.3c2.8,0.4,5.9,2.5,7.5,5.1c3.4,5.5,1.3,13-4.5,16.1c-1.8,1-2.3,1-23.9,1.2l-22,0.1v9.6v9.7h22.7c25.5,0,25.3,0,32.1-3.3c4.8-2.4,10.5-7.7,13-12.4c6-10.9,5-24.2-2.5-34l-1.9-2.4l1.2-1.2c2-2.1,4.5-6.6,5.7-10.5c3-9.5,1.4-19.2-4.7-27.7l-2.1-3l2.1-2.9c8.4-11.7,8.2-26.8-0.4-37.4l-2.1-2.5l2.2-2.9c7.8-10.1,8.6-23.8,2.1-34.8c-2.7-4.5-7.8-9.2-12.6-11.6c-6.5-3.1-7.5-3.3-25.8-3.4C30,32.9,19.8,32.9,16.3,33z"
                    />
                    <path
                      fill="currentColor"
                      d="M202.9,33.1c-4.5,0.3-5.1,0.4-9,1.9c-5.8,2.3-12.2,7.6-15.4,13c-0.9,1.5-2.2,4.4-2.9,6.5c-1.1,3.1-1.2,4.5-1.2,9.2c0,7.7,1.8,13.1,6.3,19l1.8,2.4l-1.7,2c-0.9,1.1-2.5,3.6-3.5,5.7c-5.1,10.6-4,22,3,31.9l2.1,2.9l-1.8,2.4c-4.4,5.7-6.9,13.8-6.4,20.8c0.5,6.5,3.5,14.2,7.3,18.1l1.4,1.4l-1.9,2.4c-4.6,5.8-6.6,11.8-6.7,19.3c0,9.1,2.5,15.2,9,21.7c3.2,3.2,4.7,4.3,7.8,5.9c6.8,3.3,6.7,3.3,32.1,3.3H246v-9.7v-9.6l-22-0.1c-21.8-0.1-22.1-0.1-23.9-1.2c-5.9-3.1-7.9-10.6-4.5-16.1c1.6-2.5,4.7-4.7,7.5-5.1l1.9-0.3v-10.2v-10.3l-1.7-0.3c-7.8-1.5-11.8-10.4-7.7-17.1c1.6-2.5,4.7-4.7,7.5-5.1l1.9-0.3v-10c0-9.3,0-10.1-0.8-10.1c-3.3,0-7.8-3.2-9.4-6.7c-1-2.2-1.2-6.5-0.2-8.7c1.4-3.4,6.3-7.2,9.4-7.2h1V85v-9.8l-1.9-0.3c-2.8-0.4-5.9-2.5-7.5-5.1c-3.4-5.5-1.3-13,4.5-16.1c1.8-1,2.2-1,23.9-1.2l22-0.1v-9.6v-9.7l-4.9,0c-2.8,0-11.5,0-19.5-0.1C213.6,32.9,205.2,33,202.9,33.1z"
                    />
                  </g>
                </g>
              </g>
            </svg>
            <span>3. Y-Δ Connection</span>
          </button>
          <button
            class="modal-trigger-btn justify-center"
            data-modal-target="section4"
          >
            <svg
              version="1.1"
              xmlns="http://www.w3.org/2000/svg"
              x="0px"
              y="0px"
              viewBox="0 0 256 256"
              width="24"
              height="24"
            >
              <g>
                <g>
                  <g>
                    <path
                      fill="currentColor"
                      d="M98,128v100.5h9.9h9.9V128V27.5h-9.9H98V128z"
                    />
                    <path
                      fill="currentColor"
                      d="M138.1,128v100.5h9.9h9.9V128V27.5h-9.9h-9.9V128z"
                    />
                    <path
                      fill="currentColor"
                      d="M16.3,33L10,33.1v9.6v9.6l22,0.1c21.5,0.1,22,0.1,23.8,1.2c8.3,4.4,8.3,16.1,0.1,20.2c-1.3,0.6-3,1.2-3.6,1.2H51v10.3v10.3l1.7,0.3c4,0.7,7.7,4,8.8,7.6c1.3,4.4,0.3,8.6-3,11.7c-3.3,3.1-3.3,3.1-27.2,3.1H10v10.1v10.1h21.4c23.9,0,23.9,0,27.2,3.1c3.2,3.1,4.3,7.3,3,11.7c-1.1,3.6-4.8,6.8-8.8,7.6l-1.7,0.3v9.8v9.8l1.9,0.3c2.8,0.4,5.9,2.5,7.5,5.1c3.4,5.5,1.3,13-4.5,16.1c-1.8,1-2.3,1-23.9,1.2l-22,0.1v9.6v9.7h22.7c25.5,0,25.3,0,32.1-3.3c4.8-2.4,10.5-7.7,13-12.4c6-10.9,5-24.2-2.5-34l-1.9-2.4l1.2-1.2c2-2.1,4.5-6.6,5.7-10.5c3-9.5,1.4-19.2-4.7-27.7l-2.1-3l2.1-2.9c8.4-11.7,8.2-26.8-0.4-37.4l-2.1-2.5l2.2-2.9c7.8-10.1,8.6-23.8,2.1-34.8c-2.7-4.5-7.8-9.2-12.6-11.6c-6.5-3.1-7.5-3.3-25.8-3.4C30,32.9,19.8,32.9,16.3,33z"
                    />
                    <path
                      fill="currentColor"
                      d="M202.9,33.1c-4.5,0.3-5.1,0.4-9,1.9c-5.8,2.3-12.2,7.6-15.4,13c-0.9,1.5-2.2,4.4-2.9,6.5c-1.1,3.1-1.2,4.5-1.2,9.2c0,7.7,1.8,13.1,6.3,19l1.8,2.4l-1.7,2c-0.9,1.1-2.5,3.6-3.5,5.7c-5.1,10.6-4,22,3,31.9l2.1,2.9l-1.8,2.4c-4.4,5.7-6.9,13.8-6.4,20.8c0.5,6.5,3.5,14.2,7.3,18.1l1.4,1.4l-1.9,2.4c-4.6,5.8-6.6,11.8-6.7,19.3c0,9.1,2.5,15.2,9,21.7c3.2,3.2,4.7,4.3,7.8,5.9c6.8,3.3,6.7,3.3,32.1,3.3H246v-9.7v-9.6l-22-0.1c-21.8-0.1-22.1-0.1-23.9-1.2c-5.9-3.1-7.9-10.6-4.5-16.1c1.6-2.5,4.7-4.7,7.5-5.1l1.9-0.3v-10.2v-10.3l-1.7-0.3c-7.8-1.5-11.8-10.4-7.7-17.1c1.6-2.5,4.7-4.7,7.5-5.1l1.9-0.3v-10c0-9.3,0-10.1-0.8-10.1c-3.3,0-7.8-3.2-9.4-6.7c-1-2.2-1.2-6.5-0.2-8.7c1.4-3.4,6.3-7.2,9.4-7.2h1V85v-9.8l-1.9-0.3c-2.8-0.4-5.9-2.5-7.5-5.1c-3.4-5.5-1.3-13,4.5-16.1c1.8-1,2.2-1,23.9-1.2l22-0.1v-9.6v-9.7l-4.9,0c-2.8,0-11.5,0-19.5-0.1C213.6,32.9,205.2,33,202.9,33.1z"
                    />
                  </g>
                </g>
              </g>
            </svg>
            <span>4. Y-Y Connection</span>
          </button>
        </div>
      </div>

      <!-- Section 1: Delta-Delta -->
      <div class="section-card pdf-section">
        <div class="section-header border-b pb-3 mb-4">
          <h2 class="text-2xl font-semibold text-blue-800">
            1. Delta-Delta (Δ-Δ) Connection
          </h2>
          <button
            class="modal-trigger-btn wiring-btn bg-green-500"
            data-modal-target="wiring1"
          >
            <span class="material-icons-outlined">power</span>Show Wiring
          </button>
        </div>
        <h3 class="text-xl font-medium mb-3">
          1.1 Polarity Check Voltages (at 60V line-to-line Primary)
        </h3>
        <table class="w-full data-table mb-6">
          <thead>
            <tr class="bg-gray-200">
              <th>Condition</th>
              <th>Expected Voltage</th>
              <th>Measured Voltage (V)</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="label-col">2 secondary windings in series (open)</td>
              <td class="font-mono">
                V<sub>phase</sub> or √3 V<sub>phase</sub>
              </td>
              <td><input type="number" placeholder="0.0" /></td>
            </tr>
            <tr>
              <td class="label-col">3 secondary windings in series (open)</td>
              <td class="font-mono">0 V or 2 * V<sub>phase</sub></td>
              <td><input type="number" placeholder="0.0" /></td>
            </tr>
          </tbody>
        </table>
        <h3 class="text-xl font-medium mb-3">
          1.2 Voltage Measurements (at 60V line-to-line Primary)
        </h3>
        <table class="w-full data-table mb-6">
          <thead>
            <tr class="bg-gray-200">
              <th>Terminal</th>
              <th>Measurement</th>
              <th>Voltage (V)</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td rowspan="3" class="font-bold align-middle">Primary</td>
              <td class="label-col">Line Voltage (V<sub>AB</sub>)</td>
              <td><input type="number" placeholder="300.0" /></td>
            </tr>
            <tr>
              <td class="label-col">Line Voltage (V<sub>BC</sub>)</td>
              <td><input type="number" placeholder="300.0" /></td>
            </tr>
            <tr>
              <td class="label-col">Line Voltage (V<sub>CA</sub>)</td>
              <td><input type="number" placeholder="300.0" /></td>
            </tr>
            <tr class="bg-gray-50">
              <td colspan="3"></td>
            </tr>
            <tr>
              <td rowspan="3" class="font-bold align-middle">Secondary</td>
              <td class="label-col">Line/Phase Voltage (V<sub>ab</sub>)</td>
              <td><input type="number" placeholder="100.0" /></td>
            </tr>
            <tr>
              <td class="label-col">Line/Phase Voltage (V<sub>bc</sub>)</td>
              <td><input type="number" placeholder="100.0" /></td>
            </tr>
            <tr>
              <td class="label-col">Line/Phase Voltage (V<sub>ca</sub>)</td>
              <td><input type="number" placeholder="100.0" /></td>
            </tr>
          </tbody>
        </table>
        <h3 class="text-xl font-medium mb-3">
          1.3 Secondary Waveforms (at 60V line-to-line Primary)
        </h3>
        <label for="s1-waveform" class="waveform-uploader">
          <span class="font-semibold text-gray-700"
            >Attach Secondary Vphase Waveform
          </span>
          <input
            id="s1-waveform"
            type="file"
            class="hidden waveform-input"
            accept="image/*"
          />
          <img src="" class="hidden waveform-preview" alt="Waveform Preview" />
        </label>
      </div>

      <!-- Section 2: Delta-Wye -->
      <div class="section-card pdf-section">
        <div class="section-header border-b pb-3 mb-4">
          <h2 class="text-2xl font-semibold text-blue-800">
            2. Delta-Wye (Δ-Y) Connection
          </h2>
          <button
            class="modal-trigger-btn wiring-btn bg-green-500"
            data-modal-target="wiring2"
          >
            <span class="material-icons-outlined">power</span>Show Wiring
          </button>
        </div>
        <h3 class="text-xl font-medium mb-3">
          2.1 Voltage Measurements (at 60V line-to-line Primary)
        </h3>
        <table class="w-full data-table mb-6">
          <thead>
            <tr class="bg-gray-200">
              <th>Terminal</th>
              <th>Measurement Type</th>
              <th>Measurement</th>
              <th>Voltage (V)</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td rowspan="3" class="font-bold align-middle">Primary (Δ)</td>
              <td rowspan="3" class="align-middle">Line/Phase Voltage</td>
              <td class="label-col">V<sub>AB</sub></td>
              <td><input type="number" placeholder="300.0" /></td>
            </tr>
            <tr>
              <td class="label-col">V<sub>BC</sub></td>
              <td><input type="number" placeholder="300.0" /></td>
            </tr>
            <tr>
              <td class="label-col">V<sub>CA</sub></td>
              <td><input type="number" placeholder="300.0" /></td>
            </tr>
            <tr class="bg-gray-50">
              <td colspan="4"></td>
            </tr>
            <tr>
              <td rowspan="6" class="font-bold align-middle">Secondary (Y)</td>
              <td rowspan="3" class="align-middle">Phase Voltage</td>
              <td class="label-col">V<sub>an</sub></td>
              <td><input type="number" placeholder="100.0" /></td>
            </tr>
            <tr>
              <td class="label-col">V<sub>bn</sub></td>
              <td><input type="number" placeholder="100.0" /></td>
            </tr>
            <tr>
              <td class="label-col">V<sub>cn</sub></td>
              <td><input type="number" placeholder="100.0" /></td>
            </tr>
            <tr>
              <td rowspan="3" class="align-middle border-t">Line Voltage</td>
              <td class="label-col">V<sub>ab</sub></td>
              <td><input type="number" placeholder="173.2" /></td>
            </tr>
            <tr>
              <td class="label-col">V<sub>bc</sub></td>
              <td><input type="number" placeholder="173.2" /></td>
            </tr>
            <tr>
              <td class="label-col">V<sub>ca</sub></td>
              <td><input type="number" placeholder="173.2" /></td>
            </tr>
          </tbody>
        </table>
        <h3 class="text-xl font-medium mb-3">
          2.2 Waveforms (at 60V line-to-line Primary)
        </h3>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <label for="s2-pri-phase-wf" class="waveform-uploader"
            ><span class="font-semibold text-gray-700"
              >Primary Phase Waveform</span
            ><input
              id="s2-pri-phase-wf"
              type="file"
              class="hidden waveform-input"
              accept="image/*" /><img
              src=""
              class="hidden waveform-preview"
              alt="Waveform Preview"
          /></label>
          <label for="s2-pri-line-wf" class="waveform-uploader"
            ><span class="font-semibold text-gray-700"
              >Primary Line Waveform</span
            ><input
              id="s2-pri-line-wf"
              type="file"
              class="hidden waveform-input"
              accept="image/*" /><img
              src=""
              class="hidden waveform-preview"
              alt="Waveform Preview"
          /></label>
          <label for="s2-sec-phase-wf" class="waveform-uploader"
            ><span class="font-semibold text-gray-700"
              >Secondary Phase Waveform</span
            ><input
              id="s2-sec-phase-wf"
              type="file"
              class="hidden waveform-input"
              accept="image/*" /><img
              src=""
              class="hidden waveform-preview"
              alt="Waveform Preview"
          /></label>
          <label for="s2-sec-line-wf" class="waveform-uploader"
            ><span class="font-semibold text-gray-700"
              >Secondary Line Waveform</span
            ><input
              id="s2-sec-line-wf"
              type="file"
              class="hidden waveform-input"
              accept="image/*" /><img
              src=""
              class="hidden waveform-preview"
              alt="Waveform Preview"
          /></label>
        </div>
      </div>

      <!-- Section 3: Wye-Delta -->
      <div class="section-card pdf-section">
        <div class="section-header border-b pb-3 mb-4">
          <h2 class="text-2xl font-semibold text-blue-800">
            3. Wye-Delta (Y-Δ) Connection
          </h2>
          <button
            class="modal-trigger-btn wiring-btn bg-green-500"
            data-modal-target="wiring3"
          >
            <span class="material-icons-outlined">power</span>Show Wiring
          </button>
        </div>
        <h3 class="text-xl font-medium mb-3">
          3.1 Voltage Measurements S1 Open, S2 Closed (at 60V line-to-line
          Primary)
        </h3>
        <table class="w-full data-table mb-6">
          <thead>
            <tr class="bg-gray-200">
              <th>Terminal</th>
              <th>Measurement Type</th>
              <th>Measurement</th>
              <th>Voltage (V)</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td rowspan="6" class="font-bold align-middle">Primary (Y)</td>
              <td rowspan="3" class="align-middle">Phase Voltage</td>
              <td class="label-col">V<sub>AN</sub></td>
              <td><input type="number" placeholder="173.2" /></td>
            </tr>
            <tr>
              <td class="label-col">V<sub>BN</sub></td>
              <td><input type="number" placeholder="173.2" /></td>
            </tr>
            <tr>
              <td class="label-col">V<sub>CN</sub></td>
              <td><input type="number" placeholder="173.2" /></td>
            </tr>
            <tr>
              <td rowspan="3" class="align-middle border-t">Line Voltage</td>
              <td class="label-col">V<sub>AB</sub></td>
              <td><input type="number" placeholder="300.0" /></td>
            </tr>
            <tr>
              <td class="label-col">V<sub>BC</sub></td>
              <td><input type="number" placeholder="300.0" /></td>
            </tr>
            <tr>
              <td class="label-col">V<sub>CA</sub></td>
              <td><input type="number" placeholder="300.0" /></td>
            </tr>
            <tr class="bg-gray-50">
              <td colspan="4"></td>
            </tr>
            <tr>
              <td rowspan="3" class="font-bold align-middle">Secondary (Δ)</td>
              <td rowspan="3" class="align-middle">Line/Phase Voltage</td>
              <td class="label-col">V<sub>ab</sub></td>
              <td><input type="number" placeholder="57.7" /></td>
            </tr>
            <tr>
              <td class="label-col">V<sub>bc</sub></td>
              <td><input type="number" placeholder="57.7" /></td>
            </tr>
            <tr>
              <td class="label-col">V<sub>ca</sub></td>
              <td><input type="number" placeholder="57.7" /></td>
            </tr>
          </tbody>
        </table>
        <h3 class="text-xl font-medium mb-3">
          3.2-3.4 Waveforms & Measurements (at 60V line-to-line Primary)
        </h3>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-x-4 gap-y-6">
          <!-- Column Headers -->
          <h4
            class="text-lg font-semibold text-center bg-gray-200 p-2 rounded-md"
          >
            S1 Open
          </h4>
          <h4
            class="text-lg font-semibold text-center bg-gray-200 p-2 rounded-md"
          >
            S1 Closed
          </h4>

          <!-- Frequency Row -->
          <div
            class="md:col-span-2 grid grid-cols-2 md:grid-cols-2 gap-x-4 items-center"
          >
            <p class="label-col md:col-span-1">
              Frequency across S2 (S2 Open) [Hz]
            </p>
            <br />
            <input
              class="md:col-start-1 bg-gray-100"
              type="number"
              placeholder="e.g. 150"
            />
            <input
              class="md:col-start-2 bg-gray-100"
              type="number"
              placeholder="e.g. 50"
            />
          </div>

          <!-- Waveform pairs -->
          <label for="s3-v-s2-s1open" class="waveform-uploader"
            ><span class="font-semibold text-gray-700">Voltage across S2</span
            ><input
              id="s3-v-s2-s1open"
              type="file"
              class="hidden waveform-input"
              accept="image/*" /><img
              src=""
              class="hidden waveform-preview"
              alt="Waveform Preview"
          /></label>
          <label for="s3-v-s2-s1closed" class="waveform-uploader"
            ><span class="font-semibold text-gray-700">Voltage across S2</span
            ><input
              id="s3-v-s2-s1closed"
              type="file"
              class="hidden waveform-input"
              accept="image/*" /><img
              src=""
              class="hidden waveform-preview"
              alt="Waveform Preview"
          /></label>
        </div>

        <!-- ############################-->
      </div>

      <!-- Section 3: Wye-Delta -->
      <div class="section-card pdf-section">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-x-4 gap-y-6">
          <label for="s3-sec-s2open-s1open" class="waveform-uploader"
            ><span class="font-semibold text-gray-700"
              >Secondary Phase (S2 Open)</span
            ><input
              id="s3-sec-s2open-s1open"
              type="file"
              class="hidden waveform-input"
              accept="image/*" /><img
              src=""
              class="hidden waveform-preview"
              alt="Waveform Preview"
          /></label>
          <label for="s3-sec-s2open-s1closed" class="waveform-uploader"
            ><span class="font-semibold text-gray-700"
              >Secondary Phase (S2 Open)</span
            ><input
              id="s3-sec-s2open-s1closed"
              type="file"
              class="hidden waveform-input"
              accept="image/*" /><img
              src=""
              class="hidden waveform-preview"
              alt="Waveform Preview"
          /></label>

          <label for="s3-sec-s2closed-s1open" class="waveform-uploader"
            ><span class="font-semibold text-gray-700"
              >Secondary Phase (S2 Closed)</span
            ><input
              id="s3-sec-s2closed-s1open"
              type="file"
              class="hidden waveform-input"
              accept="image/*" /><img
              src=""
              class="hidden waveform-preview"
              alt="Waveform Preview"
          /></label>
          <label for="s3-sec-s2closed-s1closed" class="waveform-uploader"
            ><span class="font-semibold text-gray-700"
              >Secondary Phase (S2 Closed)</span
            ><input
              id="s3-sec-s2closed-s1closed"
              type="file"
              class="hidden waveform-input"
              accept="image/*" /><img
              src=""
              class="hidden waveform-preview"
              alt="Waveform Preview"
          /></label>
        </div>

        <!-- ############################-->
      </div>

      <!-- Section 4: Wye-Wye -->
      <div class="section-card pdf-section">
        <div class="section-header border-b pb-3 mb-4">
          <h2 class="text-2xl font-semibold text-blue-800">
            4. Wye-Wye (Y-Y) Connection
          </h2>
          <button
            class="modal-trigger-btn wiring-btn bg-green-500"
            data-modal-target="wiring4"
          >
            <span class="material-icons-outlined">power</span>Show Wiring
          </button>
        </div>
        <h3 class="text-xl font-medium mb-3">
          4.1 Voltage Measurements (at 60V line-to-line Primary)
        </h3>
        <table class="w-full data-table mb-6">
          <thead>
            <tr class="bg-gray-200">
              <th>Terminal</th>
              <th>Measurement</th>
              <th>Switch S Open (V)</th>
              <th>Switch S Closed (V)</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td rowspan="6" class="font-bold align-middle">Primary</td>
              <td class="label-col">Phase Voltage (V<sub>AN</sub>)</td>
              <td><input type="number" placeholder="173.2" /></td>
              <td><input type="number" placeholder="173.2" /></td>
            </tr>
            <tr>
              <td class="label-col">Phase Voltage (V<sub>BN</sub>)</td>
              <td><input type="number" placeholder="173.2" /></td>
              <td><input type="number" placeholder="173.2" /></td>
            </tr>
            <tr>
              <td class="label-col">Phase Voltage (V<sub>CN</sub>)</td>
              <td><input type="number" placeholder="173.2" /></td>
              <td><input type="number" placeholder="173.2" /></td>
            </tr>
            <tr>
              <td class="label-col border-t">Line Voltage (V<sub>AB</sub>)</td>
              <td><input type="number" placeholder="300.0" /></td>
              <td><input type="number" placeholder="300.0" /></td>
            </tr>
            <tr>
              <td class="label-col">Line Voltage (V<sub>BC</sub>)</td>
              <td><input type="number" placeholder="300.0" /></td>
              <td><input type="number" placeholder="300.0" /></td>
            </tr>
            <tr>
              <td class="label-col">Line Voltage (V<sub>CA</sub>)</td>
              <td><input type="number" placeholder="300.0" /></td>
              <td><input type="number" placeholder="300.0" /></td>
            </tr>
            <tr class="bg-gray-50">
              <td colspan="4"></td>
            </tr>
            <tr>
              <td rowspan="6" class="font-bold align-middle">Secondary</td>
              <td class="label-col">Phase Voltage (V<sub>an</sub>)</td>
              <td><input type="number" placeholder="57.7" /></td>
              <td><input type="number" placeholder="57.7" /></td>
            </tr>
            <tr>
              <td class="label-col">Phase Voltage (V<sub>bn</sub>)</td>
              <td><input type="number" placeholder="57.7" /></td>
              <td><input type="number" placeholder="57.7" /></td>
            </tr>
            <tr>
              <td class="label-col">Phase Voltage (V<sub>cn</sub>)</td>
              <td><input type="number" placeholder="57.7" /></td>
              <td><input type="number" placeholder="57.7" /></td>
            </tr>
            <tr>
              <td class="label-col border-t">Line Voltage (V<sub>ab</sub>)</td>
              <td><input type="number" placeholder="100.0" /></td>
              <td><input type="number" placeholder="100.0" /></td>
            </tr>
            <tr>
              <td class="label-col">Line Voltage (V<sub>bc</sub>)</td>
              <td><input type="number" placeholder="100.0" /></td>
              <td><input type="number" placeholder="100.0" /></td>
            </tr>
            <tr>
              <td class="label-col">Line Voltage (V<sub>ca</sub>)</td>
              <td><input type="number" placeholder="100.0" /></td>
              <td><input type="number" placeholder="100.0" /></td>
            </tr>
          </tbody>
        </table>
        <h3 class="text-xl font-medium mt-8 mb-3">
          4.2 Waveforms : Switch S Open (at 60V line-to-line Primary)
        </h3>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <label for="s4-open-pri-phase-wf" class="waveform-uploader"
            ><span class="font-semibold text-gray-700"
              >Primary Phase Waveform</span
            ><input
              id="s4-open-pri-phase-wf"
              type="file"
              class="hidden waveform-input"
              accept="image/*" /><img
              src=""
              class="hidden waveform-preview"
              alt="Waveform Preview"
          /></label>
          <label for="s4-open-pri-line-wf" class="waveform-uploader"
            ><span class="font-semibold text-gray-700"
              >Primary Line Waveform</span
            ><input
              id="s4-open-pri-line-wf"
              type="file"
              class="hidden waveform-input"
              accept="image/*" /><img
              src=""
              class="hidden waveform-preview"
              alt="Waveform Preview"
          /></label>
          <label for="s4-open-sec-phase-wf" class="waveform-uploader"
            ><span class="font-semibold text-gray-700"
              >Secondary Phase Waveform</span
            ><input
              id="s4-open-sec-phase-wf"
              type="file"
              class="hidden waveform-input"
              accept="image/*" /><img
              src=""
              class="hidden waveform-preview"
              alt="Waveform Preview"
          /></label>
          <label for="s4-open-sec-line-wf" class="waveform-uploader"
            ><span class="font-semibold text-gray-700"
              >Secondary Line Waveform</span
            ><input
              id="s4-open-sec-line-wf"
              type="file"
              class="hidden waveform-input"
              accept="image/*" /><img
              src=""
              class="hidden waveform-preview"
              alt="Waveform Preview"
          /></label>
        </div>
      </div>
      <div class="section-card pdf-section">
        <h3 class="text-xl font-medium mt-8 mb-3">
          4.3 Waveforms : Switch S Closed (at 60V line-to-line Primary)
        </h3>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <label for="s4-closed-pri-phase-wf" class="waveform-uploader"
            ><span class="font-semibold text-gray-700"
              >Primary Phase Waveform</span
            ><input
              id="s4-closed-pri-phase-wf"
              type="file"
              class="hidden waveform-input"
              accept="image/*" /><img
              src=""
              class="hidden waveform-preview"
              alt="Waveform Preview"
          /></label>
          <label for="s4-closed-pri-line-wf" class="waveform-uploader"
            ><span class="font-semibold text-gray-700"
              >Primary Line Waveform</span
            ><input
              id="s4-closed-pri-line-wf"
              type="file"
              class="hidden waveform-input"
              accept="image/*" /><img
              src=""
              class="hidden waveform-preview"
              alt="Waveform Preview"
          /></label>
          <label for="s4-closed-sec-phase-wf" class="waveform-uploader"
            ><span class="font-semibold text-gray-700"
              >Secondary Phase Waveform</span
            ><input
              id="s4-closed-sec-phase-wf"
              type="file"
              class="hidden waveform-input"
              accept="image/*" /><img
              src=""
              class="hidden waveform-preview"
              alt="Waveform Preview"
          /></label>
          <label for="s4-closed-sec-line-wf" class="waveform-uploader"
            ><span class="font-semibold text-gray-700"
              >Secondary Line Waveform</span
            ><input
              id="s4-closed-sec-line-wf"
              type="file"
              class="hidden waveform-input"
              accept="image/*" /><img
              src=""
              class="hidden waveform-preview"
              alt="Waveform Preview"
          /></label>
        </div>

        <!-- ############################-->
      </div>

      <!-- Analysis/Conclusion Section -->
      <div class="section-card pdf-section">
        <h2
          class="text-2xl font-semibold border-b pb-2 mb-4 text-blue-800 flex items-center gap-3"
        >
          <span class="material-icons-outlined">draw</span>Analysis & Conclusion
        </h2>
        <textarea
          placeholder="Summarize your findings, discuss the voltage and phase relationships for each connection type, and explain the effects of floating neutrals or harmonics observed in the waveforms..."
        ></textarea>
      </div>

      <!-- Questions Section -->
      <div class="section-card pdf-section">
        <h2
          class="text-2xl font-semibold border-b pb-2 mb-4 text-blue-800 flex items-center gap-3"
        >
          <span class="material-icons-outlined">quiz</span>Questions
        </h2>
        <div class="space-y-6">
          <div>
            <h3 class="text-lg font-semibold">
              1. Discuss the third harmonics phenomena in the following
              three-phase transformer connections: Δ-Δ, Δ-Y, Y-Δ, Y-Y.
            </h3>
            <textarea placeholder="Type your answer here..."></textarea>
          </div>
          <div>
            <h3 class="text-lg font-semibold">
              2. Describe the applications of the following three-phase
              transformer connections: Δ-Δ, Δ-Y, Y-Δ, Y-Y.
            </h3>
            <textarea placeholder="Type your answer here..."></textarea>
          </div>
        </div>
      </div>
    </div>

    <!-- Instruction Modal -->
    <div
      id="instruction-modal"
      class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center p-4 z-50"
    >
      <div class="bg-white rounded-lg shadow-xl max-w-2xl w-full p-6 relative">
        <button
          id="modal-close-btn"
          class="absolute top-3 right-3 text-gray-400 hover:text-gray-800 rounded-full p-1"
        >
          <span class="material-icons-outlined">close</span>
        </button>
        <h3 id="modal-title" class="text-2xl font-bold mb-4 text-blue-800"></h3>
        <div
          id="modal-content"
          class="text-gray-700 space-y-3 prose max-w-none"
        ></div>
      </div>
    </div>

    <script>
      document.addEventListener("DOMContentLoaded", () => {
        // --- INSTRUCTION & WIRING DATA ---
        const modalData = {
          section1: {
            title: "1. Delta-Delta (Δ-Δ) Connection",
            content: `<ol>
            <li><strong>1.1 Primary & Secondary Setup:</strong> <h4><strong>Primary Side:</strong></h4>
<ul>
    <li>Connect the primary windings in a delta configuration.</li>
    <li>Supply a balanced 300 V (line-to-line) three-phase source.</li>
</ul>

<h4><strong>Secondary Side (Polarity Check):</strong></h4>
<ul>
    <li>Connect the secondaries of the first two transformers in series.</li>
    <ul>
        <li><b>Check:</b> The open-terminal voltage should equal the phase voltage. If it's √3 times the phase voltage, reverse one winding's polarity.</li>
    </ul>
    <li>Connect the third transformer's secondary in series with the first two.</li>
    <ul>
        <li><b>Check:</b> The final open-terminal voltage must be zero. If it's double the phase voltage, reverse the third winding's polarity.</li>
    </ul>
    <li>Once the voltage is zero, close the loop to complete the delta connection as shown in Figure 1(a).</li>
</ul></li>
            <li><strong>1.2 Measure Voltages:</strong> Record the phase and line voltages at both the primary and secondary terminals.</li>
            <li><strong>1.3 Observe Waveforms:</strong> Reduce the primary line voltage to 30 V. Observe and sketch the secondary waveforms.</li></ol>`,
          },
          wiring1: {
            title: "Wiring: Delta-Delta (Δ-Δ)",
            content: `<img src="D-D.png" alt="Delta-Delta Wiring Diagram" class="w-full h-auto rounded-md">`,
          },
          section2: {
            title: "2. Delta-Wye (Δ-Y) Connection",
            content: `<ol>
            <li><strong>2.1 Measure Voltages:</strong> Set the primary line voltage to 300 V. Measure and record the phase and line voltages at the secondary terminals.</li>
            <li><strong>2.2 Observe Waveforms:</strong> Set the primary line voltage to 75 V. Observe and sketch the waveforms of phase and line voltages at both primary and secondary terminals.</li></ol>`,
          },
          wiring2: {
            title: "Wiring: Delta-Wye (Δ-Y)",
            content: `<img src="D-Y.png" alt="Delta-Wye Wiring Diagram" class="w-full h-auto rounded-md">`,
          },
          section3: {
            title: "3. Wye-Delta (Y-Δ) Connection",
            content: `<ol>
            <li><strong>3.1 Measure Voltages:</strong> Set the primary line voltage to 300 V. Open switch S1 and close switch S2. Measure phase and line voltages at the primary and secondary.</li>
            <li><strong>3.2 Voltage across S2:</strong> Set primary line voltage to 100 V. Open S2. Observe and sketch the voltage waveforms across S2 when S1 is open and when S1 is closed. Measure their frequencies.</li>
            <li><strong>3.3 Secondary Phase Voltages (S2 open):</strong> Observe and sketch the secondary phase voltage waveforms when S1 is open and when it is closed (S2 remains open).</li>
            <li><strong>3.4 Secondary Phase Voltages (S2 closed):</strong> Close S2. Observe and sketch the secondary phase voltage waveforms when S1 is open and when it is closed.</li></ol>`,
          },
          wiring3: {
            title: "Wiring: Wye-Delta (Y-Δ)",
            content: `<img src="Y-D.png" alt="Wye-Delta Wiring Diagram" class="w-full h-auto rounded-md">`,
          },
          section4: {
            title: "4. Wye-Wye (Y-Y) Connection",
            content: `<ol>
            <li><strong>4.1 Measure Voltages:</strong> Set the primary line voltage to 300 V. Measure the phase and line voltages at the primary and secondary terminals, first with switch S open, and then with it closed.</li>
            <li><strong>4.2 Observe Waveforms (S open):</strong> Set the primary line voltage to 40 V. Open switch S. Observe and sketch the waveforms of phase and line voltages at the primary and secondary.</li>
            <li><strong>4.3 Observe Waveforms (S closed):</strong> Close switch S. Observe and sketch the waveforms of phase and line voltages at the primary and secondary.</li></ol>`,
          },
          wiring4: {
            title: "Wiring: Wye-Wye (Y-Y)",
            content: `<img src="Y-Y.png" alt="Wye-Wye Wiring Diagram" class="w-full h-auto rounded-md">`,
          },
        };

        // --- MODAL LOGIC ---
        const modal = document.getElementById("instruction-modal");
        const modalTitle = document.getElementById("modal-title");
        const modalContent = document.getElementById("modal-content");
        const closeModalBtn = document.getElementById("modal-close-btn");

        document.querySelectorAll(".modal-trigger-btn").forEach((button) => {
          button.addEventListener("click", () => {
            const target = button.dataset.modalTarget;
            const data = modalData[target];
            if (data) {
              modalTitle.innerHTML = data.title;
              modalContent.innerHTML = data.content;
              modal.classList.remove("hidden");
              modal.classList.add("flex");
            }
          });
        });

        const closeModal = () => {
          modal.classList.add("hidden");
          modal.classList.remove("flex");
        };
        closeModalBtn.addEventListener("click", closeModal);
        modal.addEventListener("click", (e) => {
          if (e.target === modal) closeModal();
        });

        // --- WAVEFORM IMAGE PREVIEW LOGIC ---
        document.querySelectorAll(".waveform-input").forEach((input) => {
          input.addEventListener("change", (event) => {
            const file = event.target.files[0];
            if (file) {
              const reader = new FileReader();
              const preview = event.target.nextElementSibling;
              reader.onload = (e) => {
                preview.src = e.target.result;
                preview.classList.remove("hidden");
              };
              reader.readAsDataURL(file);
            }
          });
        });

        // --- PDF EXPORT LOGIC ---
        // --- PDF EXPORT LOGIC ---
        document
          .getElementById("export-pdf")
          .addEventListener("click", async () => {
            const { jsPDF } = window.jspdf;
            const pdf = new jsPDF({
              orientation: "p",
              unit: "mm",
              format: "a4",
            });
            const pdfWidth = pdf.internal.pageSize.getWidth();
            const pdfHeight = pdf.internal.pageSize.getHeight();
            const pageMargin = 10;
            const contentWidth = pdfWidth - pageMargin * 2;
            let currentY = pageMargin;

            const exportButton = document.getElementById("export-pdf");
            exportButton.style.display = "none"; // Hide button during export
            window.scrollTo(0, 0); // Scroll to top to ensure all elements are in viewport for html2canvas

            const appContainer = document.getElementById("app-container");
            const elementsToExport = Array.from(appContainer.children); // Get all direct children of the app-container

            // Helper function to add content to PDF, handling page breaks
            const addContentToPdf = async (element) => {
              const originalDisplay = element.style.display;
              element.style.display = "block"; // Ensure visibility for html2canvas

              const canvas = await html2canvas(element, {
                scale: 2,
                useCORS: true,
                logging: false,
                allowTaint: true,
                scrollY: -window.scrollY,
                windowHeight: document.documentElement.offsetHeight,
                width: element.offsetWidth, // Ensure html2canvas captures the element's actual width
                height: element.offsetHeight, // Ensure html2canvas captures the element's actual height
              });
              const imgData = canvas.toDataURL("image/png");
              const imgProps = pdf.getImageProperties(imgData);
              const pdfImgHeight =
                (imgProps.height * contentWidth) / imgProps.width;

              // Check if adding this element will exceed the current page's height
              if (currentY + pdfImgHeight + pageMargin > pdfHeight) {
                pdf.addPage();
                currentY = pageMargin; // Reset Y position for the new page
              }

              pdf.addImage(
                imgData,
                "PNG",
                pageMargin,
                currentY,
                contentWidth,
                pdfImgHeight
              );
              currentY += pdfImgHeight + 10; // Add some padding below the element

              element.style.display = originalDisplay; // Restore original display
            };

            for (const element of elementsToExport) {
              if (element.classList.contains("page-break-after")) {
                pdf.addPage();
                currentY = pageMargin; // Reset Y position for the new page
              } else if (element.classList.contains("pdf-section")) {
                // For main sections, we'll try to capture them as a whole first
                await addContentToPdf(element);
              } else {
                // For any other direct child (like the header or other non-section elements)
                await addContentToPdf(element);
              }
            }

            pdf.save("EX06_Three-Phase_Transformer_Lab_Report.pdf");
            exportButton.style.display = "block"; // Show button after export
          });
      });
    </script>
  </body>
</html>
